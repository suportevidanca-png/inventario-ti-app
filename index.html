<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invent√°rio de Ativos de TI - Gest√£o Minimalista</title>
    <style>
        /* ESTILOS CSS - Minimalista, Responsivo e com Cores */
        :root {
            --primary-color: #007bff; /* Azul para A√ß√£o Principal (Adicionar) */
            --success-color: #28a745; /* Verde para Sucesso (Salvar/Editar) */
            --danger-color: #dc3545;  /* Vermelho para Perigo (Deletar) */
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            text-align: center;
            box-shadow: var(--box-shadow);
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* ESTILOS DE BOT√ïES E FORMUL√ÅRIOS */
        button {
            padding: 10px 15px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
            color: white;
        }

        .btn-primary { background-color: var(--primary-color); }
        .btn-primary:hover { background-color: #0056b3; }

        .btn-success { background-color: var(--success-color); }
        .btn-success:hover { background-color: #1e7e34; }

        .btn-danger { background-color: var(--danger-color); }
        .btn-danger:hover { background-color: #bd2130; }

        .btn-edit { background-color: #ffc107; color: var(--text-color); }
        .btn-edit:hover { background-color: #e0a800; }

        /* Estilo para a √°rea de filtros e bot√µes */
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap; /* Responsividade */
            gap: 10px;
        }

        #filter-input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: var(--border-radius);
            flex-grow: 1;
            max-width: 400px;
        }

        /* ESTILOS DA TABELA */
        .table-container {
            overflow-x: auto; /* Garante scroll horizontal em telas pequenas */
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px; /* Garante que o conte√∫do n√£o fique muito apertado */
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: var(--primary-color);
            color: white;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        tr:hover {
            background-color: #f0f0f0;
        }

        /* MODAL (Formul√°rio Adicionar/Editar) */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            display: none; /* Escondido por padr√£o */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .modal-content h2 {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 0;
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: var(--border-radius);
            box-sizing: border-box;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        /* ALERTAS */
        #alert-message {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: var(--border-radius);
            display: none;
            font-weight: bold;
        }

        .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        /* RESPONSIVIDADE PEQUENAS TELAS */
        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            #filter-input {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>Invent√°rio de Ativos de TI üíª</h1>
    </header>

    <div class="container">
        
        <div id="alert-message" role="alert"></div>

        <div class="controls">
            <input type="text" id="filter-input" placeholder="üîç Filtrar por ID, Nome, Localiza√ß√£o ou Status..." onkeyup="filterTable()">
            <button class="btn-primary" onclick="openModal('add')">‚ûï Adicionar Equipamento</button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Categoria</th>
                        <th>Nome</th>
                        <th>S√©rie</th>
                        <th>Localiza√ß√£o</th>
                        <th>Respons√°vel</th>
                        <th>Aquisi√ß√£o</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="inventory-table-body">
                    <tr><td colspan="9" style="text-align:center;">Carregando dados...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="data-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title"></h2>
            <form id="data-form">
                <input type="hidden" id="modal-mode">
                <input type="hidden" id="original-id"> 

                <div class="form-group">
                    <label for="id-ativo">ID do Ativo</label>
                    <input type="text" id="id-ativo" required>
                </div>
                <div class="form-group">
                    <label for="nome-equipamento">Nome do Equipamento</label>
                    <input type="text" id="nome-equipamento" required>
                </div>
                <div class="form-group">
                    <label for="localizacao-atual">Localiza√ß√£o Atual</label>
                    <input type="text" id="localizacao-atual" required>
                </div>
                <div class="form-group">
                    <label for="status">Status</label>
                    <select id="status" required>
                        <option value="Em uso">Em uso</option>
                        <option value="Em manuten√ß√£o">Em manuten√ß√£o</option>
                        <option value="Em empr√©stimo">Em empr√©stimo</option>
                        <option value="Desativado">Desativado</option>
                        <option value="Dispon√≠vel">Dispon√≠vel</option>
                    </select>
                </div>
                
                <div id="additional-fields">
                    <div class="form-group">
                        <label for="categoria">Categoria</label>
                        <input type="text" id="categoria">
                    </div>
                    <div class="form-group">
                        <label for="numero-serie">N√∫mero de S√©rie/IMEI</label>
                        <input type="text" id="numero-serie">
                    </div>
                    <div class="form-group">
                        <label for="responsavel">Respons√°vel</label>
                        <input type="text" id="responsavel">
                    </div>
                    <div class="form-group">
                        <label for="data-aquisicao">Data de Aquisi√ß√£o</label>
                        <input type="date" id="data-aquisicao">
                    </div>
                </div>

                <div class="modal-buttons">
                    <button type="button" class="btn-primary" onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="btn-success" id="submit-btn">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ‚ö†Ô∏è IMPORTANTE: Substitua pela sua URL real do Apps Script
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzh3P1mrxaDXc_DywbB0TneRMM1ZHrudgjbS8gxkYF-2hiXsIcaxsXLDvvzlK8-S9H4yg/exec";

        let inventoryData = []; // Armazena os dados atuais

        // -------------------------------------------------------------------
        // FUN√á√ïES GERAIS E DE UTILIDADE
        // -------------------------------------------------------------------

        /**
         * Exibe uma mensagem de feedback na tela.
         * @param {string} message - A mensagem a ser exibida.
         * @param {string} type - 'success' ou 'error'.
         */
        function showAlert(message, type) {
            const alertElement = document.getElementById('alert-message');
            alertElement.textContent = message;
            alertElement.className = type === 'success' ? 'alert-success' : 'alert-error';
            alertElement.style.display = 'block';
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 5000);
        }

        /**
         * Fun√ß√£o principal de comunica√ß√£o com o Apps Script.
         * @param {string} action - 'read', 'add', 'update', ou 'delete'.
         * @param {Object} data - Dados a serem enviados (apenas para POST).
         */
        async function sendRequest(action, data = null) {
            const url = action === 'read' ? `${APPS_SCRIPT_URL}?action=read` : APPS_SCRIPT_URL;
            const options = action === 'read' ? { method: 'GET' } : {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: JSON.stringify({ action: action, data: data })
            };

            try {
                const response = await fetch(url, options);
                const result = await response.json();
                
                if (result.status === 'success') {
                    // Trata as a√ß√µes de escrita/atualiza√ß√£o/dele√ß√£o
                    if (action !== 'read') {
                        showAlert(result.message, 'success');
                        await loadInventory(); // Recarrega os dados ap√≥s a modifica√ß√£o
                    }
                    return result;
                } else {
                    showAlert(result.message || 'Erro desconhecido na requisi√ß√£o.', 'error');
                    return { status: 'error', message: result.message };
                }
            } catch (error) {
                showAlert('Erro de comunica√ß√£o: N√£o foi poss√≠vel conectar ao servidor.', 'error');
                console.error('Erro de requisi√ß√£o:', error);
                return { status: 'error', message: error.message };
            }
        }

        // -------------------------------------------------------------------
        // FUN√á√ïES CRUD (CREATE, READ, UPDATE, DELETE)
        // -------------------------------------------------------------------

        /**
         * READ: Carrega todos os dados do invent√°rio e renderiza a tabela.
         */
        async function loadInventory() {
            const tableBody = document.getElementById('inventory-table-body');
            tableBody.innerHTML = '<tr><td colspan="9" style="text-align:center;">Carregando dados...</td></tr>';
            
            const result = await sendRequest('read');
            
            if (result.status === 'success') {
                inventoryData = result.data;
                renderTable(inventoryData);
            } else {
                tableBody.innerHTML = `<tr><td colspan="9" style="text-align:center; color: var(--danger-color);">${result.message || 'Falha ao carregar dados.'}</td></tr>`;
            }
        }

        /**
         * Renderiza as linhas da tabela com os dados fornecidos.
         * @param {Array} data - Lista de objetos de equipamentos.
         */
        function renderTable(data) {
            const tableBody = document.getElementById('inventory-table-body');
            tableBody.innerHTML = '';
            
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="9" style="text-align:center;">Nenhum equipamento encontrado.</td></tr>';
                return;
            }

            data.forEach(item => {
                const row = tableBody.insertRow();
                
                // Fun√ß√£o para obter o valor de forma segura, garantindo que n√£o seja undefined
                const getValue = (key) => item[key] || ''; 
                
                row.innerHTML = `
                    <td>${getValue('ID do Ativo')}</td>
                    <td>${getValue('Categoria')}</td>
                    <td>${getValue('Nome do Equipamento')}</td>
                    <td>${getValue('N√∫mero de S√©rie/IMEI')}</td>
                    <td>${getValue('Localiza√ß√£o Atual')}</td>
                    <td>${getValue('Respons√°vel')}</td>
                    <td>${getValue('Data de Aquisi√ß√£o')}</td>
                    <td><span style="font-weight: bold; color: ${getStatusColor(getValue('Status'))}">${getValue('Status')}</span></td>
                    <td>
                        <button class="btn-edit" onclick="openModal('edit', '${getValue('ID do Ativo')}')">Editar</button>
                        <button class="btn-danger" onclick="deleteEquipment('${getValue('ID do Ativo')}')">Deletar</button>
                    </td>
                `;
            });
        }
        
        /**
         * Obt√©m a cor para o status.
         */
        function getStatusColor(status) {
            switch (status) {
                case 'Em uso': return 'var(--success-color)';
                case 'Em manuten√ß√£o': return '#ffc107'; // Amarelo
                case 'Desativado': return 'var(--danger-color)';
                default: return 'var(--primary-color)';
            }
        }

        // -------------------------------------------------------------------
        // FUN√á√ïES DO MODAL (ADICIONAR/EDITAR)
        // -------------------------------------------------------------------

        /**
         * Abre o modal no modo Adicionar ou Editar.
         * @param {string} mode - 'add' ou 'edit'.
         * @param {string} id - O ID do ativo para edi√ß√£o (opcional).
         */
        function openModal(mode, id = null) {
            const modal = document.getElementById('data-modal');
            const form = document.getElementById('data-form');
            const additionalFields = document.getElementById('additional-fields');
            const modalTitle = document.getElementById('modal-title');
            
            document.getElementById('modal-mode').value = mode;
            form.reset(); // Limpa o formul√°rio

            if (mode === 'add') {
                modalTitle.textContent = "‚ûï Novo Equipamento";
                additionalFields.style.display = 'block'; // Mostrar todos os campos
                document.getElementById('id-ativo').disabled = false;
                document.getElementById('original-id').value = '';
            } else { // 'edit'
                modalTitle.textContent = "‚úçÔ∏è Editar Equipamento";
                additionalFields.style.display = 'none'; // Esconder campos que n√£o ser√£o editados (pode ser ajustado)
                document.getElementById('id-ativo').disabled = true; // N√£o permite alterar o ID
                document.getElementById('original-id').value = id;
                
                // Preenche o formul√°rio com os dados atuais
                const item = inventoryData.find(d => d['ID do Ativo'] === id);
                if (item) {
                    document.getElementById('id-ativo').value = item['ID do Ativo'] || '';
                    document.getElementById('nome-equipamento').value = item['Nome do Equipamento'] || '';
                    document.getElementById('localizacao-atual').value = item['Localiza√ß√£o Atual'] || '';
                    document.getElementById('status').value = item['Status'] || 'Em uso';
                    // Nota: outros campos como Categoria, S√©rie etc. n√£o s√£o essenciais para atualiza√ß√£o
                }
            }

            modal.style.display = 'flex';
        }

        /**
         * Fecha o modal.
         */
        function closeModal() {
            document.getElementById('data-modal').style.display = 'none';
        }

        // Listener para submiss√£o do formul√°rio
        document.getElementById('data-form').addEventListener('submit', handleFormSubmit);

        /**
         * Lida com a submiss√£o do formul√°rio, decidindo se √© Adicionar ou Editar.
         */
        async function handleFormSubmit(event) {
            event.preventDefault();
            const mode = document.getElementById('modal-mode').value;
            const form = document.getElementById('data-form');
            const formData = {};

            // Mapeia os dados do formul√°rio para as chaves exatas do cabe√ßalho da Planilha
            formData['ID do Ativo'] = form.elements['id-ativo'].value;
            formData['Nome do Equipamento'] = form.elements['nome-equipamento'].value;
            formData['Localiza√ß√£o Atual'] = form.elements['localizacao-atual'].value;
            formData['Status'] = form.elements['status'].value;

            // Para o modo 'add', inclua os campos adicionais
            if (mode === 'add') {
                formData['Categoria'] = form.elements['categoria'].value;
                formData['N√∫mero de S√©rie/IMEI'] = form.elements['numero-serie'].value;
                formData['Respons√°vel'] = form.elements['responsavel'].value;
                formData['Data de Aquisi√ß√£o'] = form.elements['data-aquisicao'].value;
            }

            if (mode === 'add') {
                await sendRequest('add', formData);
            } else if (mode === 'edit') {
                // Para edi√ß√£o, s√≥ enviamos o ID, Status e Localiza√ß√£o.
                // O Apps Script s√≥ foi configurado para atualizar Localiza√ß√£o e Status.
                const updateData = {
                    'ID do Ativo': document.getElementById('original-id').value,
                    'Status': formData['Status'],
                    'Localiza√ß√£o Atual': formData['Localiza√ß√£o Atual']
                };
                await sendRequest('update', updateData);
            }

            closeModal();
        }

        /**
         * DELETE: Confirma e envia requisi√ß√£o para deletar um equipamento.
         * NOTA: A fun√ß√£o de DELETAR *n√£o* foi implementada no seu Apps Script.
         * Este √© apenas um placeholder para o frontend.
         */
        function deleteEquipment(id) {
            alert("Aviso: A fun√ß√£o 'Deletar' n√£o foi implementada no Apps Script (backend). Se desejar que ela funcione, voc√™ precisar√° adicionar um manipulador 'delete' no Apps Script!");
            // Se voc√™ adicionar a fun√ß√£o no Apps Script:
            // if (confirm(`Tem certeza que deseja DELETAR o ativo ID: ${id}?`)) {
            //     sendRequest('delete', { 'ID do Ativo': id }); 
            // }
        }

        // -------------------------------------------------------------------
        // FUN√á√ÉO DE FILTRO
        // -------------------------------------------------------------------
        
        /**
         * Filtra os dados da tabela com base no texto de entrada.
         */
        function filterTable() {
            const input = document.getElementById('filter-input');
            const filter = input.value.toUpperCase();
            
            // Filtra os dados originais
            const filteredData = inventoryData.filter(item => {
                // Combina os valores das colunas relevantes em uma string para busca
                const searchableText = `${item['ID do Ativo']} ${item['Nome do Equipamento']} ${item['Localiza√ß√£o Atual']} ${item['Status']}`.toUpperCase();
                return searchableText.includes(filter);
            });
            
            renderTable(filteredData);
        }


        // Inicializa o carregamento dos dados quando a p√°gina carrega
        window.onload = loadInventory;
        
        // Permite fechar o modal clicando fora dele
        window.onclick = function(event) {
            const modal = document.getElementById('data-modal');
            if (event.target == modal) {
                closeModal();
            }
        }

    </script>
</body>
</html>
